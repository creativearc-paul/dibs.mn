{layout='layouts/_global-layout'}

{if logged_in}
    {if !segment_2}
        {exp:channel:entries limit="1" author_id="CURRENT_USER"}
            HELLO EID {entry_id} {url_title}
                {redirect="/shifts/{url_title}"}
        {/exp:channel:entries}
    {/if}
{/if}
{!-- ################# HEADER --}



{embed="shifts/.header"
    theAuthorId="{exp:dibs:get_author url_title='{segment_2}' channel_id='4'}"

    {!-- runs a total of entries owned by user in channel to get completed value --}
    completedShifts="{exp:channel:entries channel='completed_shifts' dynamic='no' author_id='CURRENT_USER' show_expired='only'}{if count == total_results}{total_results}{/if}{/exp:channel:entries}"
}

<hr>

{!-- ################# TABLE --}

{exp:query sql="select author_id as shift_author_id from exp_channel_titles
where url_title = '{segment_2}' and channel_id = 4"}

{if no_results}  <p>Please <a href="/member/login">login</a> or use your magic link!</p>  {/if}

    {!-- embed table and pass the author id --}
    {embed="shifts/.shifts-table" theAuthorId="{shift_author_id}"}

{/exp:query}


